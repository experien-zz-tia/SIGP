/*
 * File: frmActualizarTutorAcad.js
 * Date: Sun Jul 04 2011 22:40:39 GMT-0430 (Hora est√°ndar de Venezuela)
 * 
 * This file was generated by Ext Designer version 1.1.2.
 * http://www.sencha.com/products/designer/
 *
 * This file will be generated the first time you export.
 *
 * You should implement event handling and custom methods in this
 * class.
 */


Ext.apply(Ext.form.VTypes, {
	soloNumeroMask: /[ \d\-\(\)]/,
	soloNumero: function(value,field){  
    return value.replace(/[ \-\(\)]/g,'').length == 12 ;
}
});

Ext.apply(Ext.form.VTypes, {
	emailIguales: function(val, field) {
	if (field.campoInicial) {
		var email = Ext.getCmp(field.campoInicial);
		if  (val != email.getValue()){
			field.markInvalid(); 
			return false;
		}
	}
	return true;
},
emailIgualesText:'Cuentas de correo no coindicen.<Br/>Por favor, verifiquelas.'
});



var evento = "";
frmActualizarTutorAcad = Ext.extend(frmActualizarTutorAcadUi, {
    initComponent: function() {
    	frmActualizarTutorAcad.superclass.initComponent.call(this);
        Ext.getCmp('btnGuardar').on('click',this.guardarTutor);
        Ext.getCmp('btnSalir').on('click',this.salir);
        Ext.getCmp('cmbDecanato').on('select',this.cargarDepartamentos);
//        Ext.getCmp('txtCedula').on('submit',this.buscarTutor);
        // Ext.getCmp('txtCedula').on('keypress',this.teclaEnter);
        this.buscarTutor();
    },
    
    salir:function(){
    	Ext.getCmp('frmActualizarTutorAcadWin').hide();   
   	
   },
  
    cargarDepartamentos:function(){
    	Ext.getCmp('cmbDepartamento').clearValue();
  	  	Ext.getCmp('cmbDepartamento').store.reload({params: {decanato_id: Ext.getCmp('cmbDecanato').getValue()}});
    },
    
    guardarTutor:function(){	
    		if (Ext.getCmp('registroTutorForm').getForm().isValid()){
    			Ext.getCmp('registroTutorForm').getForm().submit({
    				waitMsg : 'Enviando datos...', 
			 											
    				params:{txtCedula:  Ext.getCmp('txtCedula').getValue(),
							departamento: Ext.getCmp('cmbDepartamento').getValue(),
							decanato: Ext.getCmp('cmbDecanato').getValue(),
							tipoevento: evento
						}, 
			                                                
						failure: function (form, action){          	                                 
							Ext.MessageBox.show({  
								title: 'Error',  
								msg: 'Error al guardar.',  
								buttons: Ext.MessageBox.OK,  
								icon: Ext.MessageBox.ERROR  
							});  
						},  
		                                                    
						success: function (form, action){                                              
							Ext.MessageBox.show({  
								title: 'Informaci&oacute;n',  
								msg: 'Actualizaci&oacute;n exitosa.',  
								buttons: Ext.MessageBox.OK,  
								icon: Ext.MessageBox.INFO
							});
						}
    			}); 
	
    		}else{
    			Ext.MessageBox.show({
    				title: "Error",
    				msg: "Datos incompletos o no v&aacute;lidos, por favor verifique.",
    				width:400,
    				buttons: Ext.MessageBox.OK,
    				icon: Ext.MessageBox.ERROR
    			});
    		}
    },	
    
	buscarTutor:function(){
		var cedula = Ext.getCmp('txtCedula');
		
			Ext.Ajax.request({
				url: '/SIGP/tutorAcademico/buscarTutorExistente',
				method: 'POST',
				params: 'cedula =' + cedula.getValue(),
				success: function(respuesta, request) {
	      			var jsonData = Ext.util.JSON.decode(respuesta.responseText);
	      				if((jsonData.success ==true) && (jsonData.errorMsj!='')){
         	        				var datos = jsonData.datos;
         	        				Ext.getCmp('txtCedula').setValue(datos.cedula);
         	        				Ext.getCmp('txtNombre').setValue(datos.nombre);
	         	        			Ext.getCmp('txtApellido').setValue(datos.apellido);
	         	        			Ext.getCmp('txtTelefono').setValue(datos.telefono);
	         	        			Ext.getCmp('txtCorreo').setValue(datos.email);
	         	        			Ext.getCmp('txtRepetirCorreo').setValue(datos.email);
	         	        			Ext.getCmp('txtCargo').setValue(datos.cargo);
         	        				
	         	        			var cmbDecanato = Ext.getCmp('cmbDecanato');      					
	              					var storeDec = cmbDecanato.getStore();
	              					storeDec.load({
	              					   callback: function() {
	              					      cmbDecanato.setValue(datos.decanatoId);
	              					   }
	              					});
	              					var cmbDpto = Ext.getCmp('cmbDepartamento');                          
                                    var storeDpto = cmbDpto.getStore();
                                    storeDpto.load({
                                       params: {decanato_id: datos.decanatoId},
                                       callback: function() {
                                          cmbDpto.setValue(datos.departamentoId);
                                       }
                                    });
                                    
         	        				Ext.getCmp('cmbDepartamento').setValue(datos.departamento);
	         	        			habilitarCampos(true);
	         	        			evento = "actualizar";
         	        		 };       				
	      				}});}

});

 function habilitarCampos(flag){
	if (flag==true){
		Ext.getCmp('txtNombre').enable();
		Ext.getCmp('txtApellido').enable();
		Ext.getCmp('txtTelefono').enable();
		Ext.getCmp('txtCorreo').enable();
		Ext.getCmp('txtRepetirCorreo').enable();
     	Ext.getCmp('txtCargo').enable();
     	Ext.getCmp('cmbDecanato').enable();
     	Ext.getCmp('cmbDepartamento').enable();
	}else{
		Ext.getCmp('txtNombre').disable();
		Ext.getCmp('txtApellido').disable();
		Ext.getCmp('txtTelefono').disable();
		Ext.getCmp('txtCorreo').disable();
		Ext.getCmp('txtRepetirCorreo').disable();
     	Ext.getCmp('txtCargo').disable();
     	Ext.getCmp('cmbDecanato').disable();
     	Ext.getCmp('cmbDepartamento').disable();
		
	}
	
}